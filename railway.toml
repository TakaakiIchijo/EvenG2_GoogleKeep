# Railway デプロイ設定
#
# Railpack（Railway のデフォルトビルダー）が requirements.txt を検出して
# Python アプリとして自動認識します。追加のビルダー設定は不要です。
#
# このファイルにより、Railway は以下の2つのサービスを自動認識します：
#   - backend  : Python/Flask API サーバー（gkeepapi で Google Keep に接続）
#   - frontend : Vite ビルド済み静的ファイル（serve で配信）
#
# デプロイ手順は README.md の「Railway へのデプロイ」セクションを参照してください。

# ---- バックエンドサービス ----
[[services]]
name = "backend"
source = "backend"

[services.deploy]
startCommand = "gunicorn --bind 0.0.0.0:${PORT:-8080} server:app"
healthcheckPath = "/api/health"
healthcheckTimeout = 30

[services.variables]
PORT = "8080"
# 以下の変数は Railway ダッシュボードの Variables タブで設定してください
# KEEP_EMAIL        = "your-email@gmail.com"
# KEEP_MASTER_TOKEN = "aas_et/..."
# FRONTEND_ORIGIN   = "https://your-frontend.up.railway.app"

# ---- フロントエンドサービス ----
[[services]]
name = "frontend"
source = "."

[services.build]
# VITE_BACKEND_URL はビルド時に埋め込まれます。
# Railway ダッシュボードの frontend サービスの Variables タブで設定してください。
# 設定後は必ず Redeploy（リビルド）を実行してください。
# 例: VITE_BACKEND_URL = https://backend-production-xxxx.up.railway.app
buildCommand = "npm install && npm run build"

[services.deploy]
startCommand = "npx serve dist --listen ${PORT:-3000} --no-clipboard"
healthcheckPath = "/"
healthcheckTimeout = 30

[services.variables]
PORT = "3000"
